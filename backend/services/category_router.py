import logging
from typing import Dict, List

logger = logging.getLogger(__name__)

class CategoryRouter:
    def __init__(self):
        self.keywords = {
            "health": [
                "ê±´ê°•", "ë³‘ì›", "ì˜ì‚¬", "ì¹˜ë£Œ", "ì•½", "ì¦ìƒ", "ì•„í””", "ì•„í”„", "ì§„ë£Œ", "ê²€ì§„",
                "í˜ˆì••", "ë‹¹ë‡¨", "ì½œë ˆìŠ¤í…Œë¡¤", "ìš´ë™", "ë‹¤ì´ì–´íŠ¸", "ì˜ì–‘", "ë¹„íƒ€ë¯¼", "ê°ê¸°",
                "ë‘í†µ", "ë³µí†µ", "ë°œì—´", "ê¸°ì¹¨", "ëª¸ì‚´", "í”¼ë¡œ", "ìŠ¤íŠ¸ë ˆìŠ¤", "ìˆ˜ë©´", "ë¶ˆë©´ì¦"
            ],
            "travel": [
                "ì—¬í–‰", "ê´€ê´‘", "íœ´ê°€", "ì—¬í–‰ì§€", "ìˆ™ë°•", "í˜¸í…”", "íœì…˜", "í•­ê³µ", "ê¸°ì°¨", "ë²„ìŠ¤",
                "ì œì£¼ë„", "ë¶€ì‚°", "ê²½ì£¼", "ê°•ë¦‰", "ì „ì£¼", "í•´ì™¸ì—¬í–‰", "êµ­ë‚´ì—¬í–‰", "íŒ¨í‚¤ì§€", 
                "ììœ ì—¬í–‰", "ë§›ì§‘", "ì¹´í˜", "ë°•ë¬¼ê´€", "ë†€ì´ê³µì›", "í•´ë³€", "ì‚°", "ë“±ì‚°"
            ],
            "investment": [
                "íˆ¬ì", "ì£¼ì‹", "í€ë“œ", "ì ê¸ˆ", "ì˜ˆê¸ˆ", "ë¶€ë™ì‚°", "ì¬í…Œí¬", "ê¸ˆìœµ", "ì€í–‰",
                "ìˆ˜ìµ", "ì†ì‹¤", "ë°°ë‹¹", "ì´ì", "ëŒ€ì¶œ", "ë³´í—˜", "ì—°ê¸ˆ", "í‡´ì§", "ë…¸í›„",
                "ì„¸ê¸ˆ", "ì ˆì„¸", "ISA", "IRP", "ì—°ë§ì •ì‚°", "cryptocurrency", "ë¹„íŠ¸ì½”ì¸"
            ],
            "legal": [
                "ë²•ë¥ ", "ë³€í˜¸ì‚¬", "ì†Œì†¡", "ê³„ì•½", "ìƒì†", "ìœ ì–¸", "ì´í˜¼", "ì¬ì‚°ë¶„í• ", "ì–‘ìœ¡ë¹„",
                "ì„ëŒ€ì°¨", "ì „ì„¸", "ì›”ì„¸", "ë¶€ë™ì‚°ê³„ì•½", "ë§¤ë§¤", "ì‚¬ê¸°", "í”¼í•´", "ì†í•´ë°°ìƒ",
                "êµí†µì‚¬ê³ ", "ì˜ë£Œì‚¬ê³ ", "ë…¸ë™", "í•´ê³ ", "í‡´ì§ê¸ˆ", "ì„ê¸ˆ", "ê·¼ë¡œê³„ì•½"
            ]
        }
        
        logger.info("ğŸ·ï¸ Category Router ì´ˆê¸°í™” ì™„ë£Œ")
        logger.info(f"ğŸ“ ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ ìˆ˜: {[(cat, len(keywords)) for cat, keywords in self.keywords.items()]}")
    
    async def classify_category(self, text: str) -> str:
        """í…ìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜"""
        text_lower = text.lower()
        scores = {}
        
        # ê° ì¹´í…Œê³ ë¦¬ë³„ ì ìˆ˜ ê³„ì‚°
        for category, keywords in self.keywords.items():
            score = 0
            for keyword in keywords:
                if keyword in text_lower:
                    score += 1
            scores[category] = score
        
        # ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
        if scores:
            best_category = max(scores, key=scores.get)
            if scores[best_category] > 0:
                logger.info(f"ğŸ¯ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜: '{text[:30]}...' â†’ {best_category} (ì ìˆ˜: {scores[best_category]})")
                return best_category
        
        # ê¸°ë³¸ê°’
        logger.info(f"ğŸ¯ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜: '{text[:30]}...' â†’ health (ê¸°ë³¸ê°’)")
        return "health"
